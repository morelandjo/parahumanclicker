<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Parahuman Clicker</title>

<script src="https://code.jquery.com/jquery-1.12.3.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>

<script>
var shards = 200;
var conflict = 0;
var parahumans = 0;
var living_parahumans = [];
var classes = ["Mover","Shaker","Brute","Blaster","Breaker","Master","Tinker","Thinker","Striker","Changer","Trump","Stranger"];
var class_created = [0,0,0,0,0,0,0,0,0,0,0,0];
var cost = 0;

$( document ).ready(function() {
	$( ".shard_container" ).click(function() {
		shards++;
		update_shards();
	});
	
	$( ".button" ).mouseup(function() {
    	var element = $(this).find(".cost");
    	$(element).text("100")
    	if (shards >= cost) {
			shards = shards - cost;
			update_shards();
			if ($(this).attr("id") == "create1"){
				var y = 'random';
			}else{

				var y = $(this).attr("id").replace("classno", "");
			}

			create_parahuman(parahumans,y,cost);
		}
    })
  	.mousedown(function() {
    	cost = $(this).find(".cost").text();
    	var element = $(this).find(".cost");
	
		timeout = setInterval(function(){
        	if (cost < shards){
        		cost++
        		$(element).text(cost)
        	}
    	}, 100);
	
  	});

  	$(document).mouseup(function(){
    	clearInterval(timeout);
    	return false;
	});
	
	update_shards();
	update_conflict();

	var global_clock = setInterval(time, 1000);
});


function update_shards(){
	$('.num_shards').text(shards);
	update_spawn();	
}

function update_conflict(){
	$('.num_conflict').text(conflict);
}

function update_spawn(){
		if (shards >= 100) {
			$( ".overlay" ).each(function( i ) {
				$(this).removeClass('overlay1').addClass('overlay2');
			});
		}
		if (shards < 100 ){
				$('.overlay').removeClass('overlay2').addClass('overlay1');
		}
		
}

function create_parahuman(id,class_check,power){
	parahumans++;
	living_parahumans.push(id);
	if (class_check == "random"){
		var thisclass = Math.floor((Math.random() * classes.length));
	}else{
		var thisclass = class_check;
	}
	class_created[thisclass] = 1;
	thisclass = classes[thisclass];
	check_classes();
	var timer = 100;
	var cd = 0;
	//var minutes = Math.floor(timer / 60);
	//var seconds = timer-(minutes * 60);
	$( "#parahuman_container" ).append( '<div id="parahuman" class="parahuman'+id+'"><div id="protrait"><img src="images/face1.png" /></div><div id="stats"><p>Name: Bob<br>Power level: '+power+'<br>Type: '+thisclass+'<br>Conflict per second: 2<br>Shards upon death: '+power+'</p></p></div><div id="life"><p>HP: <span id="timer'+id+'">'+timer+'</span><div id="progressbar'+id+'""></div></p></div></div>' );
	var countdown = setInterval(frame, 1000);
	function frame() {
		
		if(events == 1 && id == targets && cd == 0){
			//do something eventful
			//minutes = minutes + 5;
			//console.log("event");
			cd = 1;
		}
		if(cd==1 && events==0){
			cd = 0;
		}

		if (timer == 0){
		
			clearInterval(countdown);
			kill_parahuman(id,power);
		}
		if (timer == 0){}else{
		conflict = conflict + 2;
		update_conflict();
		}
		timer--
		$( function() {
    		$( "#progressbar"+id ).progressbar({
      			value: timer
    		});
  		} );
		
		$( "#timer"+id ).text(timer);
	}
	
}

function kill_parahuman(id,gainshards){
	$( ".parahuman"+id ).remove();
	shards = shards+Number(gainshards);
	update_shards();
	living_parahumans.splice( $.inArray(id, living_parahumans), 1 );
}

function time(){
	//console.log("tick");
	event_system();
	
}
var tick = 0;
var events = 0;
var targets = 0;
function event_system(){
	var roll = Math.floor((Math.random() * 10) + 1);
	if (roll == 1 && tick == 0){
		tick = 20;
		events = 1;
		targets = Math.floor((Math.random() * living_parahumans.length));

	}
	if (tick > 0){
		tick--;
	}
	if(tick == 0){
		events = 0;
	}

}

function check_classes(){
	for (var i = 0; i < class_created.length; i++) {
    	if (class_created[i] == 1){
    		$("#classno"+i).show(2000);
    	}
	}	
}
</script>

<style>
.left{
	float:left;	
	width:50%;
}
.left h3{
text-align:center;	
}
.right{
	float:left;
	width:50%;
}
.shard_container{
	margin: 0 auto;	
	width:50%;
	cursor:pointer;
}
.shard_container img{
	width:100%;	
}
#container{
	width: 600px;
	margin:0 auto;	
}

#container h1{
text-align:center;	
}

.cost{
margin-left:20px;

}

.button{
	border:3px solid black;
	height:60px;
	line-height:60px;
	text-align:center;
	font-size: 21px;	
	cursor: pointer;
}
.title{
	height: 60px;
    line-height: 60px;	
}

.overlay1{
	background-color: rgba(39,62,84,0.52);
    z-index: 2;
    color: gray;
    width: 100%;
    height: 100%;
    opacity: 0.5;
    float: left;
}

#parahuman_container{
	border: 3px solid black;
    padding: 20px;	
}

#parahuman{
	display: inline-block; font-size: 20px; width: 100%; border-bottom: 1px solid black;	
}

#protrait{
	float:left;
}

#stats{
	float:left;	
}

#stats p {
	margin-top:0; margin-left:20px;	
}

#life{
	float:right;	
}
.secondary{
	display:none;
}
</style>

</head>

<body>

	<div id="container">
    	<h1>Parahuman Clicker</h1>
		<div class="left">
        	<h3>Shards: <span class="num_shards"></span></h3>
            <div class="shard_container"><img src="images/shard.png" /></div>
        </div>
        <div class="right">
        	<h3>Conflict: <span class="num_conflict"></span></h3>
            <div id="create1" class="button">
            	<div class="overlay overlay1">
                	<div class="title">Create Parahuman <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno0" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Mover <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno1" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Shaker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno2" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Brute <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno3" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Blaster <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno4" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Breaker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno5" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Master <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno6" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Tinker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno7" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Thinker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno8" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Striker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno9" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Changer <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno10" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Trump <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno11" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Stranger <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>

            
        </div>
        <div style="clear:both;"></div>
        <div id="parahuman_container">
        	
        </div>
	</div>
</body>
</html>
