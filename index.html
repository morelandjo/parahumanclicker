<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<title>Parahuman Clicker</title>

<script src="https://code.jquery.com/jquery-1.12.3.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css">
<link rel="stylesheet" href="style/style.css">
<!-- Thank you to Shemetz for providing name generation code used as a starting point -->
<script src="names.js"></script>

<script>
var shards = 0;
var conflict = 0;
var parahumans = 0;
var living_parahumans = [];
var classes = ["Mover","Shaker","Brute","Blaster","Breaker","Master","Tinker","Thinker","Striker","Changer","Trump","Stranger"];
var class_created = [0,0,0,0,0,0,0,0,0,0,0,0];
var cost = 0;
var warrior = 0;
var harvester = 0;
var gardener = 0;
var news = [];
var live = 0;

$( document ).ready(function() {
	$( ".shard_container" ).click(function() {
		shards++;
		update_shards();
	});

	$( "#warrior .plus_btn" ).click(function() {
		warrior_skill()
	});
	
	$( "#harvester .plus_btn" ).click(function() {
		harvester_skill()
	});
	
	$( "#gardener .plus_btn" ).click(function() {
		gardener_skill()
	});
	
	$( ".button" ).mouseup(function() {
    	var element = $(this).find(".cost");
    	$(element).text("100")
    	if (shards >= cost) {
			shards = shards - cost;
			update_shards();
			if ($(this).attr("id") == "create1"){
				var y = 'random';
			}else{

				var y = $(this).attr("id").replace("classno", "");
			}

			create_parahuman(parahumans,y,cost);
		}
    })
  	.mousedown(function() {
    	
			cost = $(this).find(".cost").text();
    		var element = $(this).find(".cost");
	timeout = window.setTimeout(function () {
			timeout = setInterval(function(){
        		if (cost < shards){
        			cost++
        			$(element).text(cost)
        		}
    		}, 100);
	}, 400);
		
	
  	});

  	$(document).mouseup(function(){
    	if (typeof timeout != "undefined"){
    		clearInterval(timeout);
    		return false;
    	}
	});

	$(function(){
		$('.slider-arrow').click(function(){
        	if($(this).hasClass('show')){
	    		$( ".slider-arrow, .panel" ).animate({
          			left: "+=300"
		  		}, 700, function() {
          	  // Animation complete.
         	 });
		  	$(this).html('Skills &laquo;').removeClass('show').addClass('hide');
       	}
       	else {   	
	    	$( ".slider-arrow, .panel" ).animate({
        		left: "-=300"
			}, 700, function() {
            // Animation complete.
        	});
			$(this).html('Skills &raquo;').removeClass('hide').addClass('show');    
        	}
   		 });

	});

	$( "#warrior" ).tooltip({
  		content: "The warrior trait unlocks after 100 conflict.",
  		track:true
	});
	
	$( "#harvester" ).tooltip({
  		content: "The harvester trait unlocks after 200 conflict.",
  		track:true
	});
	
	$( "#gardener" ).tooltip({
  		content: "The gardener trait unlocks after 300 conflict.",
  		track:true
	});

	$( "#harvester .plus_btn" ).tooltip({
  		content: "<p>The Harvester skill increases the shards returned when a prahuman dies</p><p>Next Level: </p><p>Cost: 200 shards<br>Effect: +2% shards on death</p>",
  		track:true
	});
	
	$( "#warrior .plus_btn" ).tooltip({
  		content: "<p>The Warrior skill increases conflict automatically</p><p>Next Level: </p><p>Cost: 100 shards<br>Effect: +5 conflict per second</p>",
  		track:true
	});
	
	$( "#gardener .plus_btn" ).tooltip({
  		content: "<p>The Gardener skill generates shards automatically</p><p>Next Level: </p><p>Cost: 300 shards<br>Effect: +10 shards per second</p>",
  		track:true
	});
	
	importcookie();
	update_shards();
	update_conflict();

	var global_clock = setInterval(time, 1000);
});


function update_shards(){
	$('.num_shards').text(shards);
	update_spawn();	
}

function update_conflict(){
	$('.num_conflict').text(conflict);

	if (conflict >= 100) {
		$("#warrior").removeClass('unavailable').addClass('available');
		if ($('#warrior').tooltip()){
			$('#warrior').tooltip("destroy");
		}
		
	}
	if (conflict >= 200) {
		$("#harvester").removeClass('unavailable').addClass('available');
		if ($('#harvester').tooltip()){
			$('#harvester').tooltip("destroy");
		}
		
	}
	
	if (conflict >= 300) {
		$("#gardener").removeClass('unavailable').addClass('available');
		if ($('#gardener').tooltip()){
			$('#gardener').tooltip("destroy");
		}
		
	}
	
}

function update_spawn(){
		if (shards >= 100) {
			$( ".overlay" ).each(function( i ) {
				$(this).removeClass('overlay1').addClass('overlay2');
			});
		}
		if (shards < 100 ){
				$('.overlay').removeClass('overlay2').addClass('overlay1');
		}
		
}

function create_parahuman(id,class_check,power){
	parahumans++;
	living_parahumans.push(id);
	if (class_check == "random"){
		var thisclass = Math.floor((Math.random() * classes.length));
	}else{
		var thisclass = class_check;
	}
	class_created[thisclass] = 1;
	thisclass = classes[thisclass];
	check_classes();
	var initial_timer = 100;
	var timer = 100;
	var cd = 0;
	var name = name_generate();
	news_message("cape",name);
	//var minutes = Math.floor(timer / 60);
	//var seconds = timer-(minutes * 60);
	$( "#parahuman_container" ).append( '<div id="parahuman" class="parahuman'+id+'"><div id="protrait"><img class="pimage'+id+'" src="images/face1.png" /></div><div id="stats"><p>Name: '+name+'<br>Power level: '+power+'<br>Type: '+thisclass+'<br>Conflict per second: 2<br>Shards upon death: <span id="sharddeath'+id+'"></span></p></p></div><div id="life"><p>HP: <span id="timer'+id+'">'+timer+'</span><div id="progressbar'+id+'""></div></p></div></div>' );
	var countdown = setInterval(frame, 1000);
	function frame() {
		//console.log("tick "+events+" "+id+" "+targets+" "+cd+" "+living_parahumans);
		if(events == 1 && id == targets && cd == 0){
			//do something eventful
			
			var figure = event_trigger();
			//console.log("figure "+figure);
			if (figure + timer < 0){
				timer = 0;	
			}else if (figure+timer > initial_timer) {
					timer = initial_timer;
			}else{
				timer = figure + timer;	
				//console.log("timer "+timer);
			}
			if (figure < 0){
				$(".parahuman"+id).animate({backgroundColor: '#ff0000'}, '1000');
				$(".parahuman"+id).animate({backgroundColor: '#ffffff'}, '1000');
			}else if (figure > 0 && figure+timer < initial_timer){
				$(".parahuman"+id).animate({backgroundColor: '#00ff0c'}, '1000');
				$(".parahuman"+id).animate({backgroundColor: '#ffffff'}, '1000');
			}
			//minutes = minutes + 5;
			//console.log("event");
			cd = 1;
		}
		if(cd==1 && events==0){
			cd = 0;
		}

		if (timer == 0){
		
			clearInterval(countdown);
			kill_parahuman(id,Number(power)+(Number(power)*(harvester*.02)));
			news_message("death",name);
		}
		if (timer == 0){}else{
		conflict = conflict + 2;
		update_conflict();
		}
		//timer--
		$( function() {
    		$( "#progressbar"+id ).progressbar({
      			value: (timer/initial_timer)*100
    		});
  		} );
		
		$( "#timer"+id ).text(timer);
		$( "#sharddeath"+id ).text(Number(power)+(Number(power)*(harvester*.02)));
	}
	
}

function kill_parahuman(id,gainshards){
	$(".pimage"+id).attr("src","images/dead.jpg");
	$(".parahuman"+id).animate({backgroundColor: '#000000'}, 5000);
	timeout = window.setTimeout(function () {
		$( ".parahuman"+id ).remove();
	}, 5000);
	//$( ".parahuman"+id ).remove();
	shards = shards+Number(gainshards);
	update_shards();
	living_parahumans.splice( $.inArray(id, living_parahumans), 1 );
}

function time(){
	//console.log(warrior);
	scroller();
	event_system();
	makecookie();

	if (warrior > 0){
		conflict = conflict + 5*warrior;
		update_conflict();
	}
	
	if (gardener > 0){
		shards = shards + 10*gardener;
		update_shards();	
	}
	
}
var tick = 0;
var events = 0;
var targets = 0;
function event_system(){
	//var roll = Math.floor((Math.random() * 2) + 1);
	//if (roll == 1 && tick == 0){
		if (tick == 0){
		tick = 2;
		events = 1;
		targets = living_parahumans[Math.floor((Math.random() * living_parahumans.length))];

	}
	if (tick > 0){
		tick--;
	}
	if(tick == 0){
		events = 0;
	}

}

function check_classes(){
	for (var i = 0; i < class_created.length; i++) {
    	if (class_created[i] == 1){
    		$("#classno"+i).show(2000);
    	}
	}	
}

function warrior_skill(){
	if (shards >= (warrior+1)*100){
		//console.log("fire");
		shards = shards - (warrior+1)*100;
		update_shards();
		warrior++;
		$( "#warrior_lvl" ).text( warrior );
		$('#warrior .plus_btn').tooltip("destroy");
		$( "#warrior .plus_btn" ).tooltip({
  		content: "<p>The Warrior skill increases conflict automatically</p><p>Current level: "+warrior*5+" conflict per second</p><p>Next Level: </p><p>Cost: "+(warrior+1)*100+" shards<br>Effect: +"+(warrior+1)*5+" conflict per second</p>",
  		track:true
	});
	}
}

function harvester_skill(){
	if (shards >= (harvester+1)*200){
		//console.log("fire");
		shards = shards - (warrior+1)*200;
		update_shards();
		harvester++;
		$( "#harvester_lvl" ).text( harvester );
		$('#harvester .plus_btn').tooltip("destroy");
		$( "#harvester .plus_btn" ).tooltip({
  		content: "<p>The Harvester skill increases the shards returned when a prahuman dies</p><p>Current level: +"+harvester*2+"% shards returned on parahuman death</p><p>Next Level: </p><p>Cost: "+(harvester+1)*200+" shards<br>Effect: +"+(harvester+1)*2+"% shards returned on parahuman death</p>",
  		track:true
	});
	}
}

function gardener_skill(){
	if (shards >= (gardener+1)*300){
		//console.log("fire");
		shards = shards - (gardener+1)*300;
		update_shards();
		gardener++;
		$( "#gardener_lvl" ).text( gardener );
		$('#gardener .plus_btn').tooltip("destroy");
		$( "#gardener .plus_btn" ).tooltip({
  		content: "<p>The Gardener skill generates shards automatically</p><p>Current level: +"+gardener*10+"% shards per second</p><p>Next Level: </p><p>Cost: "+(gardener+1)*300+" shards<br>Effect: +"+(gardener+1)*10+"% shards per second</p>",
  		track:true
	});
	}
}




String.prototype.capitalize = function() {
    return this.charAt(0).toUpperCase() + this.slice(1);
}

function name_generate() {
	var namechance = [4, 4, 4, 4, 3, 4, 4, 2, 2, 2, 4, 4, 5, 10, 6, 9, 5, 9, 4, 5, 4, 6, 5, 3, 3, 3, 5, 5, 4, 4, 5, 11]; 
	var name;
		switch(namechance[Math.floor(Math.random() * namechance.length)]) {
    		case 6:
        		name = nouns[Math.floor(Math.random() * nouns.length)].capitalize() + " " + nouns[Math.floor(Math.random() * nouns.length)].capitalize();
				return name;
        		break;
    		case 5:
        		name = nouns[Math.floor(Math.random() * nouns.length)].capitalize() + nouns[Math.floor(Math.random() * nouns.length)];
				return name;
        		break;
			case 2:
        		name = "The "+nouns[Math.floor(Math.random() * nouns.length)].capitalize();
				return name;
        		break;
			case 3:
        		name = pretitles[Math.floor(Math.random() * pretitles.length)] + " " + nouns[Math.floor(Math.random() * nouns.length)].capitalize();
				return name;
        		break;
			case 4:
        		name = "The "+nouns[Math.floor(Math.random() * nouns.length)].capitalize() + " " + posttitles[Math.floor(Math.random() * posttitles.length)].capitalize();
				return name;
        		break;
			case 8:
        		name = verbs[Math.floor(Math.random() * verbs.length)].capitalize() + nouns[Math.floor(Math.random() * nouns.length)];
				return name;
        		break;
			case 9:
        		name = adjectives[Math.floor(Math.random() * adjectives.length)].capitalize() + nouns[Math.floor(Math.random() * nouns.length)];
				return name;
        		break;
			case 10:
        		name = adjectives[Math.floor(Math.random() * adjectives.length)].capitalize() + " " + posttitles[Math.floor(Math.random() * posttitles.length)];
				return name;
        		break;
			case 11:
        		name = nouns[Math.floor(Math.random() * nouns.length)].capitalize() + " the " + adjectives[Math.floor(Math.random() * adjectives.length)].capitalize();
				return name;
        		break;
			
		}
}

function event_trigger(){
	var pick = Math.floor((Math.random() * 2) + 1);
	
	if (pick == 1){
		return good_event();
	}
	if (pick == 2){
		return bad_event();
	}
}

function good_event(){
	var base = 5;
	var plus = Math.floor((Math.random() * 2) + 1);
	var modifier = Math.floor((Math.random() * 10) + 1);
	if (plus == 1){
		base = base + modifier;	
	}else{
		base = base - modifier;
	}
	return base;
	
}

function bad_event(){
	var base = -20;
	var plus = Math.floor((Math.random() * 2) + 1);
	var modifier = Math.floor((Math.random() * 5) + 1);
	if (plus == 1){
		base = base + modifier;	
	}else{
		base = base - modifier;
	}
	return base;
	
}



	
function news_message(type,name){
	if (type == "cape"){
		var message = "A new cape was seen in Brockton Bay today, calling themselves " + name+".";	
	}
	
	if (type == "death"){
		var message = name+" has died.";	
	}
	
	news.push(message);
}

function scroller(){
	//console.log("tick "+news.length+" "+live);
	if(news.length > 0 && live == 0){
		live = 1;
		$( "#ticker02" ).append("<li class='one' style='position: relative; list-style: none'>"+news[0]+"</li>");
	
		var width = $("#ticker02 .one").width();
		var total_width = width+$("#container").width();
		$("#ticker02 .one").css("right", -Math.abs(width));
		$("#ticker02 .one").animate({ 
    		right: "+="+total_width,
  		}, total_width/.14, function() {
    		news.splice(0, 1);
			$( ".one" ).remove();
			live = 0;
  		});
	}
}

function makecookie(){
	var savestring=[];
	//shards,conflict,class_created,warrior,harvester,gardener
	savestring.push(shards,conflict,class_created,warrior,harvester,gardener);
	console.log(savestring);
	document.cookie = "save="+savestring;
}

function getCookie(name){
    var re = new RegExp(name + "=([^;]+)");
    var value = re.exec(document.cookie);
    return (value != null) ? unescape(value[1]) : null;
}

function importcookie(){
	var stringval = getCookie("save");
	var stringval = stringval.split(',');
	console.log (stringval);
	//shards = stringval[0];
	//conflict = stringval[1];
	//class_created = [];
	//class_created.push(stringval[2],stringval[3],stringval[4],stringval[5],stringval[6],stringval[7],stringval[8],stringval[9],stringval[10],stringval[11],stringval[12],stringval[13]);
	//warrior = stringval[14];
	//harvester = stringval[15];
	//gardener = stringval[16];
}

</script>


</head>

<body>
	<div class="master">
	<div id="container">
    	<h1>Parahuman Clicker</h1>
        
        <ul id="ticker02" style="overflow:hidden;">
		</ul>
        
		<div class="left">
        	<h3>Shards: <span class="num_shards"></span></h3>
            <div class="shard_container"><img src="images/shard.png" /></div>
        </div>
        <div class="right">
        	<h3>Conflict: <span class="num_conflict"></span></h3>
            <div id="create1" class="button">
            	<div class="overlay overlay1">
                	<div class="title">Create Parahuman <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno0" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Mover <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno1" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Shaker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno2" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Brute <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno3" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Blaster <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno4" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Breaker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno5" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Master <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno6" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Tinker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno7" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Thinker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno8" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Striker <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno9" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Changer <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno10" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Trump <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>
            <div id="classno11" class="button secondary">
            	<div class="overlay overlay1">
                	<div class="title">Create Stranger <span class="cost">100 </span><img src="images/shard_icon.png" /></div>
            	</div>
            </div>

            
        </div>

        <div style="clear:both;"></div>
        <div id="parahuman_container">
        	
        </div>
	</div>
	</div>
	<div class="panel">
		<h1>Skills</h1>
		<div id="warrior" class="unavailable" title="1">
			<div style="text-align: center; width: 280px; margin: 0 auto; padding: 10px 0px; border: 1px solid black;">
				<i class="fa fa-shield fa-2x" aria-hidden="true"></i>
				<div style="vertical-align: super; padding-left: 10px; display: inline-block;">Warrior | level <span id="warrior_lvl">0</span>
					<span class="plus_btn">+</span>
				</div>
			</div>
		</div>
        <div style="margin:20px;"></div>
        <div id="harvester" class="unavailable" title="1">
			<div style="text-align: center; width: 280px; margin: 0 auto; padding: 10px 0px; border: 1px solid black;">
				<i class="fa fa-diamond fa-2x" aria-hidden="true"></i>
				<div style="vertical-align: super; padding-left: 10px; display: inline-block;">Harvester | level <span id="harvester_lvl">0</span>
					<span class="plus_btn">+</span>
				</div>
			</div>
		</div>
        <div style="margin:20px;"></div>
        <div id="gardener" class="unavailable" title="1">
			<div style="text-align: center; width: 280px; margin: 0 auto; padding: 10px 0px; border: 1px solid black;">
				<i class="fa fa-leaf fa-2x" aria-hidden="true"></i>
				<div style="vertical-align: super; padding-left: 10px; display: inline-block;">Gardener | level <span id="gardener_lvl">0</span>
					<span class="plus_btn">+</span>
				</div>
			</div>
		</div>
    </div>
      
      <a href="javascript:void(0);" class="slider-arrow show">Skills &raquo;</a>
</body>
</html>
